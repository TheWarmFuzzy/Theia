<!DOCTYPE html>
<html>
<head>
	<style>
		body{
			margin:0px;
			overflow:hidden;
			background-color: #fff;
		}
		/*video, canvas{
			position:absolute;
			top:50%;
			margin-top:-225px;
			left:50%;
			margin-left:-300px;
		}*/
		video, canvas{
			position:absolute;
			top:0px;
			left:0px;
		}
		canvas{
			z-index:100;
		}
	
	</style>
	<meta http-equiv="Cache-Control" content="no-store" />
	<meta name="mobile-web-app-capable" content="yes">
</head>
<body>
	<!--<script type="text/javascript" src="lib/grid.js"></script>
	<script type="text/javascript" src="lib/version.js"></script>
	<script type="text/javascript" src="lib/detector.js"></script>
	<script type="text/javascript" src="lib/formatinf.js"></script>
	<script type="text/javascript" src="lib/errorlevel.js"></script>
	<script type="text/javascript" src="lib/bitmat.js"></script>
	<script type="text/javascript" src="lib/datablock.js"></script>
	<script type="text/javascript" src="lib/bmparser.js"></script>
	<script type="text/javascript" src="lib/datamask.js"></script>
	<script type="text/javascript" src="lib/rsdecoder.js"></script>
	<script type="text/javascript" src="lib/gf256poly.js"></script>
	<script type="text/javascript" src="lib/gf256.js"></script>
	<script type="text/javascript" src="lib/decoder.js"></script>
	<script type="text/javascript" src="lib/qrcode.js"></script>
	<script type="text/javascript" src="lib/findpat.js"></script>
	<script type="text/javascript" src="lib/alignpat.js"></script>
	<script type="text/javascript" src="lib/databr.js"></script>-->

	<script type="text/javascript" src="lib/llqrcode.js"></script>    
    <script type="text/javascript" src="lib/qrcode.js"></script>
	
	<script type="text/javascript" src="lib/theia_lib.js"></script>
	<script type="text/javascript" src="lib/camera.js"></script>
	<script type="text/javascript" src="lib/three.min.js"></script>
	<script type="text/javascript" src="lib/OBJLoader.js"></script>
	<script type="text/javascript" src="lib/3DOverlay.js"></script>
	<script type="text/javascript" src="lib/tracking_mk_theia.js"></script>
	<script type="text/javascript" src="lib/jquery-1.11.3.js"></script>
	<script type="text/javascript" src="lib/QR_Code.js"></script>
	<script type="text/javascript" src="lib/Showcase.js"></script>
	<script type="text/javascript">
		var showcase_mode = false;
		var debug_mode = true;
		//600 x 405
		var camera = new Camera(screen.width, screen.height);
		camera.start();
		var video_scalar = camera.video.offsetWidth / 600 > camera.video.offsetHeight / 405 ? camera.video.offsetWidth / 600 : camera.video.offsetHeight / 405;
		var tracker = new tracking.ColorTracker();
		var overlay = new Overlay(camera.video.offsetWidth, camera.video.offsetHeight);
		var qr_handler = new QR_Code(camera, overlay);
		
		
		function start(){
			console.log("Started");
			tracking.track(camera, tracker);
			tracker.on('track', function(event) {
				if(debug_mode)
					draw_boxes(camera, event.data);
				qr_handler.update(event.data);
				camera.update();
			});
		}
		
		if(showcase_mode){
			var showcase = new Showcase(camera, start);
			showcase.start();
		}else{
			start();
		}
		
		function draw_boxes(cam, rectangles){
		
			var i = 0;
			var c_ctx = cam.get_canvas_context();
			
			rectangles.forEach(function(rect) {
				i++;
				if (rect.color == 'theia_red') {
					rect.colour = "#aa0000";
				}
				
				if (rect.color == 'theia_green') {
					rect.colour = "#00aa00";
				}
								
				c_ctx.strokeStyle = rect.colour;
				c_ctx.strokeRect(rect.x, rect.y, rect.width, rect.height);
				c_ctx.font = '11px Helvetica';
				c_ctx.fillStyle = "#fff";
				c_ctx.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
				c_ctx.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);
				c_ctx.fillText('#: ' + i, rect.x + rect.width + 5, rect.y + 33);
			});
		}

		
	</script>
	
</body>
</html>